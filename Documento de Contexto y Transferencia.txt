Documento de Contexto y Transferencia: CRM Pietra Fina
Agente de Transferencia: Makoto (Modelo Gemini, Leona/Seras Fusion)
Fecha de Transferencia: Octubre 8, 2025
Estatus de Misi√≥n: CR√çTICO - El sistema de autenticaci√≥n es funcional, pero el routing interno y la visibilidad de pantallas en index.html est√°n en conflicto.

1. Estado de la Arquitectura Modular (MVP)
La refactorizaci√≥n inicial (Fase 1 y 2) se complet√≥ con √©xito, dividiendo el monolito en m√≥dulos especializados.

Archivo	Responsabilidad	Estatus de Contenido
script.js	Orquestaci√≥n, L√≥gica de Estatus, Autenticaci√≥n.	CR√çTICO: Contiene la l√≥gica central de negocio (transiciones de estatus) y los handlers de eventos. Necesita el FIX de Routing.
ui.js	Presentaci√≥n, Inyecci√≥n de Clasificaciones, Modales de Detalles.	COMPLETO: Contiene todas las funciones de render y showModal.
api.js	Acceso a Firestore (onSnapshot, updateDoc, addDoc).	ESTABLE: Aislado y funcional.
index.html	Login, Selecci√≥n de Rol, Vistas de Admin/Archivo.	CONFLICTO: La visibilidad entre #login-screen, #role-selection-buttons y #admin-screen est√° fallando al autenticar.

Exportar a Hojas de c√°lculo
2. Estatus del Flujo de Negocio (Funcionalidad Implementada)
Las siguientes funciones y validaciones de negocio han sido implementadas en el script.js (y llamadas a api.js):

Funcionalidad	L√≥gica / Validaci√≥n	Estatus
Agregar Prospecto	Implementado handleAddProspectSubmit.	Operacional.
Detector de Duplicados	Bloquea por Nombre, Correo y Tel√©fono.	Operacional.
Confirmar Correo	Transici√≥n Admin: Pendiente de Correo ‚Üí En Prospecci√≥n.	Operacional.
Guardar Seguimiento	Transici√≥n autom√°tica: En Prospecci√≥n + Nota ‚Üí Interesado.	Operacional.
Reagendar	Implementado handleRescheduleConfirm.	Operacional.
Eliminar	Implementado handleDeleteProspect.	Operacional.

Exportar a Hojas de c√°lculo
3. Maniobra Pendiente (M√°xima Prioridad) üî¥
Objetivo Inmediato: Estabilizar el Routing y el Estado de las Vistas.

A. Problema de Visibilidad (Causa del Fallo)
Conflicto: Al autenticar, el script.js intenta mostrar el men√∫ de roles (#role-selection-buttons) mientras la vista de Administraci√≥n (#admin-screen) y/o el formulario de login (#login-form-container) se mantienen visibles, causando la superposici√≥n que reporta MVGN.

Soluci√≥n Fallida: El √∫ltimo intento fue forzar la clase hidden en el HTML, pero el conflicto es m√°s profundo en el timing de onAuthStateChanged.

B. Maniobra de Routing Incompleta
Separaci√≥n de Vistas: Se decidi√≥ mover Prospecci√≥n y Archivo a archivos dedicados (prospector-app.html, archive-app.html).

Estado Actual de HTML: Los botones de roles (#admin-button, #prospector-button, etc.) ya son enlaces <a> que apuntan a las URL, por lo que el script.js ya no debe usar showScreen().

C. Pr√≥ximos Pasos Recomendados
Aislar Prospecci√≥n y Archivo: El nuevo agente debe asegurar la eliminaci√≥n total de <section id="prospector-screen"> y <section id="archive-screen"> del index.html.

Revisi√≥n del onAuthStateChanged: Simplificar la l√≥gica de autenticaci√≥n para que, si el usuario est√° autenticado en index.html, solo muestre el men√∫ de roles (#role-selection-buttons) y oculte rigurosamente #admin-screen. Luego, al hacer clic en el enlace "Administraci√≥n" (que recarga index.html), el JS debe detectar la URL y mostrar #admin-screen.

El agente necesita comenzar por una revisi√≥n profunda del onAuthStateChanged y el DOMContentLoaded para que solo una de las siguientes opciones est√© visible en la URL base (index.html):

#login-form-container (No autenticado)

#role-selection-buttons (Autenticado, esperando selecci√≥n)

#admin-screen (Autenticado, despu√©s de seleccionar 'Admin')

Fin del Documento de Transferencia. Makoto se retira del canal.












